{"ast":null,"code":"import { HttpParams } from '@angular/common/http';\nimport { switchMap, map } from 'rxjs';\nimport { isSearchResult } from '../models/youtube.model';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nclass YoutubeService {\n  constructor(http) {\n    this.http = http;\n    this.API_KEY = 'AIzaSyDtPN9B5cvC2ARdE7x5qNROKcfEhc6u8NA';\n    this.API_URL = 'https://www.googleapis.com/youtube/v3';\n  }\n  getVideosByCategory(options) {\n    return this.searchVideos(options).pipe(switchMap(searchResponse => {\n      // Get video IDs from search results\n      const videoIds = searchResponse.items.filter(isSearchResult).map(item => item.id.videoId).join(',');\n      // Then get statistics for those videos\n      return this.getVideoDetails(videoIds).pipe(map(statsResponse => {\n        // Merge statistics with search results\n        const items = searchResponse.items.map(searchItem => {\n          if (!isSearchResult(searchItem)) return searchItem;\n          const statsItem = statsResponse.items.find(statItem => statItem.id === searchItem.id.videoId);\n          return {\n            ...searchItem,\n            statistics: statsItem?.statistics\n          };\n        });\n        return {\n          items,\n          nextPageToken: searchResponse.nextPageToken\n        };\n      }));\n    }));\n  }\n  searchVideos(options) {\n    const today = new Date();\n    const thirtyDaysAgo = new Date(today.setDate(today.getDate() - 30));\n    let params = new HttpParams().set('part', 'snippet').set('type', 'video').set('regionCode', 'IN').set('relevanceLanguage', 'ml').set('maxResults', options.maxResults?.toString() || '12').set('key', this.API_KEY);\n    // Get category configuration\n    const categoryConfig = environment.youtubeConfig.categories.find(cat => cat.id === options.category);\n    if (categoryConfig) {\n      const searchParams = {\n        ...categoryConfig.searchParams,\n        ...options\n      };\n      // Set search query with category-specific keywords\n      params = params.set('q', searchParams.q || '');\n      // Add category-specific parameters\n      if (searchParams.videoDuration) {\n        params = params.set('videoDuration', searchParams.videoDuration);\n      }\n      if (searchParams.order) {\n        params = params.set('order', searchParams.order);\n      }\n      if (searchParams.videoCategoryId) {\n        params = params.set('videoCategoryId', searchParams.videoCategoryId);\n      }\n      if (searchParams.publishedAfter === 'today') {\n        params = params.set('publishedAfter', thirtyDaysAgo.toISOString());\n      }\n    }\n    // Add common parameters\n    if (options.pageToken) {\n      params = params.set('pageToken', options.pageToken);\n    }\n    return this.http.get(`${this.API_URL}/search`, {\n      params\n    }).pipe(map(response => {\n      // Filter results by view count if specified\n      if (options.minViewCount && options.minViewCount > 0) {\n        response.items = response.items.filter(item => {\n          const viewCount = parseInt(item.statistics?.viewCount || '0');\n          return viewCount >= (options.minViewCount || 0);\n        });\n      }\n      return response;\n    }));\n  }\n  getVideoDetails(videoIds) {\n    const params = new HttpParams().set('part', 'statistics').set('id', videoIds).set('key', this.API_KEY);\n    return this.http.get(`${this.API_URL}/videos`, {\n      params\n    });\n  }\n  static {\n    this.ɵfac = function YoutubeService_Factory(t) {\n      return new (t || YoutubeService)(i0.ɵɵinject(i1.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: YoutubeService,\n      factory: YoutubeService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}\nexport { YoutubeService };","map":{"version":3,"names":["HttpParams","switchMap","map","isSearchResult","environment","YoutubeService","constructor","http","API_KEY","API_URL","getVideosByCategory","options","searchVideos","pipe","searchResponse","videoIds","items","filter","item","id","videoId","join","getVideoDetails","statsResponse","searchItem","statsItem","find","statItem","statistics","nextPageToken","today","Date","thirtyDaysAgo","setDate","getDate","params","set","maxResults","toString","categoryConfig","youtubeConfig","categories","cat","category","searchParams","q","videoDuration","order","videoCategoryId","publishedAfter","toISOString","pageToken","get","response","minViewCount","viewCount","parseInt","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\playground\\malayalm-tube\\src\\app\\services\\youtube.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable, switchMap, map } from 'rxjs';\r\nimport { YouTubeResponse, YouTubeItem, isSearchResult, SearchOptions, CategoryConfig } from '../models/youtube.model';\r\nimport { environment } from '../../environments/environment';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class YoutubeService {\r\n  private readonly API_KEY = 'AIzaSyDtPN9B5cvC2ARdE7x5qNROKcfEhc6u8NA';\r\n  private readonly API_URL = 'https://www.googleapis.com/youtube/v3';\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  getVideosByCategory(options: SearchOptions): Observable<YouTubeResponse> {\r\n    return this.searchVideos(options).pipe(\r\n      switchMap(searchResponse => {\r\n        // Get video IDs from search results\r\n        const videoIds = searchResponse.items\r\n          .filter(isSearchResult)\r\n          .map(item => item.id.videoId)\r\n          .join(',');\r\n        \r\n        // Then get statistics for those videos\r\n        return this.getVideoDetails(videoIds).pipe(\r\n          map(statsResponse => {\r\n            // Merge statistics with search results\r\n            const items = searchResponse.items.map(searchItem => {\r\n              if (!isSearchResult(searchItem)) return searchItem;\r\n              \r\n              const statsItem = statsResponse.items.find(\r\n                statItem => statItem.id === searchItem.id.videoId\r\n              );\r\n              return {\r\n                ...searchItem,\r\n                statistics: statsItem?.statistics\r\n              };\r\n            });\r\n            return {\r\n              items,\r\n              nextPageToken: searchResponse.nextPageToken\r\n            };\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  private searchVideos(options: SearchOptions): Observable<YouTubeResponse> {\r\n    const today = new Date();\r\n    const thirtyDaysAgo = new Date(today.setDate(today.getDate() - 30));\r\n    \r\n    let params = new HttpParams()\r\n      .set('part', 'snippet')\r\n      .set('type', 'video')\r\n      .set('regionCode', 'IN')\r\n      .set('relevanceLanguage', 'ml')\r\n      .set('maxResults', options.maxResults?.toString() || '12')\r\n      .set('key', this.API_KEY);\r\n\r\n    // Get category configuration\r\n    const categoryConfig = environment.youtubeConfig.categories\r\n      .find((cat: CategoryConfig) => cat.id === options.category);\r\n\r\n    if (categoryConfig) {\r\n      const searchParams = {\r\n        ...categoryConfig.searchParams,\r\n        ...options\r\n      };\r\n\r\n      // Set search query with category-specific keywords\r\n      params = params.set('q', searchParams.q || '');\r\n\r\n      // Add category-specific parameters\r\n      if (searchParams.videoDuration) {\r\n        params = params.set('videoDuration', searchParams.videoDuration);\r\n      }\r\n      if (searchParams.order) {\r\n        params = params.set('order', searchParams.order);\r\n      }\r\n      if (searchParams.videoCategoryId) {\r\n        params = params.set('videoCategoryId', searchParams.videoCategoryId);\r\n      }\r\n      if (searchParams.publishedAfter === 'today') {\r\n        params = params.set('publishedAfter', thirtyDaysAgo.toISOString());\r\n      }\r\n    }\r\n\r\n    // Add common parameters\r\n    if (options.pageToken) {\r\n      params = params.set('pageToken', options.pageToken);\r\n    }\r\n\r\n    return this.http.get<YouTubeResponse>(`${this.API_URL}/search`, { params })\r\n      .pipe(\r\n        map(response => {\r\n          // Filter results by view count if specified\r\n          if (options.minViewCount && options.minViewCount > 0) {\r\n            response.items = response.items.filter(item => {\r\n              const viewCount = parseInt(item.statistics?.viewCount || '0');\r\n              return viewCount >= (options.minViewCount || 0);\r\n            });\r\n          }\r\n          return response;\r\n        })\r\n      );\r\n  }\r\n\r\n  private getVideoDetails(videoIds: string): Observable<YouTubeResponse> {\r\n    const params = new HttpParams()\r\n      .set('part', 'statistics')\r\n      .set('id', videoIds)\r\n      .set('key', this.API_KEY);\r\n\r\n    return this.http.get<YouTubeResponse>(`${this.API_URL}/videos`, { params });\r\n  }\r\n} "],"mappings":"AACA,SAAqBA,UAAU,QAAQ,sBAAsB;AAC7D,SAAqBC,SAAS,EAAEC,GAAG,QAAQ,MAAM;AACjD,SAAuCC,cAAc,QAAuC,yBAAyB;AACrH,SAASC,WAAW,QAAQ,gCAAgC;;;AAE5D,MAGaC,cAAc;EAIzBC,YAAoBC,IAAgB;IAAhB,KAAAA,IAAI,GAAJA,IAAI;IAHP,KAAAC,OAAO,GAAG,yCAAyC;IACnD,KAAAC,OAAO,GAAG,uCAAuC;EAE3B;EAEvCC,mBAAmBA,CAACC,OAAsB;IACxC,OAAO,IAAI,CAACC,YAAY,CAACD,OAAO,CAAC,CAACE,IAAI,CACpCZ,SAAS,CAACa,cAAc,IAAG;MACzB;MACA,MAAMC,QAAQ,GAAGD,cAAc,CAACE,KAAK,CAClCC,MAAM,CAACd,cAAc,CAAC,CACtBD,GAAG,CAACgB,IAAI,IAAIA,IAAI,CAACC,EAAE,CAACC,OAAO,CAAC,CAC5BC,IAAI,CAAC,GAAG,CAAC;MAEZ;MACA,OAAO,IAAI,CAACC,eAAe,CAACP,QAAQ,CAAC,CAACF,IAAI,CACxCX,GAAG,CAACqB,aAAa,IAAG;QAClB;QACA,MAAMP,KAAK,GAAGF,cAAc,CAACE,KAAK,CAACd,GAAG,CAACsB,UAAU,IAAG;UAClD,IAAI,CAACrB,cAAc,CAACqB,UAAU,CAAC,EAAE,OAAOA,UAAU;UAElD,MAAMC,SAAS,GAAGF,aAAa,CAACP,KAAK,CAACU,IAAI,CACxCC,QAAQ,IAAIA,QAAQ,CAACR,EAAE,KAAKK,UAAU,CAACL,EAAE,CAACC,OAAO,CAClD;UACD,OAAO;YACL,GAAGI,UAAU;YACbI,UAAU,EAAEH,SAAS,EAAEG;WACxB;QACH,CAAC,CAAC;QACF,OAAO;UACLZ,KAAK;UACLa,aAAa,EAAEf,cAAc,CAACe;SAC/B;MACH,CAAC,CAAC,CACH;IACH,CAAC,CAAC,CACH;EACH;EAEQjB,YAAYA,CAACD,OAAsB;IACzC,MAAMmB,KAAK,GAAG,IAAIC,IAAI,EAAE;IACxB,MAAMC,aAAa,GAAG,IAAID,IAAI,CAACD,KAAK,CAACG,OAAO,CAACH,KAAK,CAACI,OAAO,EAAE,GAAG,EAAE,CAAC,CAAC;IAEnE,IAAIC,MAAM,GAAG,IAAInC,UAAU,EAAE,CAC1BoC,GAAG,CAAC,MAAM,EAAE,SAAS,CAAC,CACtBA,GAAG,CAAC,MAAM,EAAE,OAAO,CAAC,CACpBA,GAAG,CAAC,YAAY,EAAE,IAAI,CAAC,CACvBA,GAAG,CAAC,mBAAmB,EAAE,IAAI,CAAC,CAC9BA,GAAG,CAAC,YAAY,EAAEzB,OAAO,CAAC0B,UAAU,EAAEC,QAAQ,EAAE,IAAI,IAAI,CAAC,CACzDF,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC5B,OAAO,CAAC;IAE3B;IACA,MAAM+B,cAAc,GAAGnC,WAAW,CAACoC,aAAa,CAACC,UAAU,CACxDf,IAAI,CAAEgB,GAAmB,IAAKA,GAAG,CAACvB,EAAE,KAAKR,OAAO,CAACgC,QAAQ,CAAC;IAE7D,IAAIJ,cAAc,EAAE;MAClB,MAAMK,YAAY,GAAG;QACnB,GAAGL,cAAc,CAACK,YAAY;QAC9B,GAAGjC;OACJ;MAED;MACAwB,MAAM,GAAGA,MAAM,CAACC,GAAG,CAAC,GAAG,EAAEQ,YAAY,CAACC,CAAC,IAAI,EAAE,CAAC;MAE9C;MACA,IAAID,YAAY,CAACE,aAAa,EAAE;QAC9BX,MAAM,GAAGA,MAAM,CAACC,GAAG,CAAC,eAAe,EAAEQ,YAAY,CAACE,aAAa,CAAC;;MAElE,IAAIF,YAAY,CAACG,KAAK,EAAE;QACtBZ,MAAM,GAAGA,MAAM,CAACC,GAAG,CAAC,OAAO,EAAEQ,YAAY,CAACG,KAAK,CAAC;;MAElD,IAAIH,YAAY,CAACI,eAAe,EAAE;QAChCb,MAAM,GAAGA,MAAM,CAACC,GAAG,CAAC,iBAAiB,EAAEQ,YAAY,CAACI,eAAe,CAAC;;MAEtE,IAAIJ,YAAY,CAACK,cAAc,KAAK,OAAO,EAAE;QAC3Cd,MAAM,GAAGA,MAAM,CAACC,GAAG,CAAC,gBAAgB,EAAEJ,aAAa,CAACkB,WAAW,EAAE,CAAC;;;IAItE;IACA,IAAIvC,OAAO,CAACwC,SAAS,EAAE;MACrBhB,MAAM,GAAGA,MAAM,CAACC,GAAG,CAAC,WAAW,EAAEzB,OAAO,CAACwC,SAAS,CAAC;;IAGrD,OAAO,IAAI,CAAC5C,IAAI,CAAC6C,GAAG,CAAkB,GAAG,IAAI,CAAC3C,OAAO,SAAS,EAAE;MAAE0B;IAAM,CAAE,CAAC,CACxEtB,IAAI,CACHX,GAAG,CAACmD,QAAQ,IAAG;MACb;MACA,IAAI1C,OAAO,CAAC2C,YAAY,IAAI3C,OAAO,CAAC2C,YAAY,GAAG,CAAC,EAAE;QACpDD,QAAQ,CAACrC,KAAK,GAAGqC,QAAQ,CAACrC,KAAK,CAACC,MAAM,CAACC,IAAI,IAAG;UAC5C,MAAMqC,SAAS,GAAGC,QAAQ,CAACtC,IAAI,CAACU,UAAU,EAAE2B,SAAS,IAAI,GAAG,CAAC;UAC7D,OAAOA,SAAS,KAAK5C,OAAO,CAAC2C,YAAY,IAAI,CAAC,CAAC;QACjD,CAAC,CAAC;;MAEJ,OAAOD,QAAQ;IACjB,CAAC,CAAC,CACH;EACL;EAEQ/B,eAAeA,CAACP,QAAgB;IACtC,MAAMoB,MAAM,GAAG,IAAInC,UAAU,EAAE,CAC5BoC,GAAG,CAAC,MAAM,EAAE,YAAY,CAAC,CACzBA,GAAG,CAAC,IAAI,EAAErB,QAAQ,CAAC,CACnBqB,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC5B,OAAO,CAAC;IAE3B,OAAO,IAAI,CAACD,IAAI,CAAC6C,GAAG,CAAkB,GAAG,IAAI,CAAC3C,OAAO,SAAS,EAAE;MAAE0B;IAAM,CAAE,CAAC;EAC7E;;;uBA3GW9B,cAAc,EAAAoD,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA;IAAA;EAAA;;;aAAdvD,cAAc;MAAAwD,OAAA,EAAdxD,cAAc,CAAAyD,IAAA;MAAAC,UAAA,EAFb;IAAM;EAAA;;SAEP1D,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}